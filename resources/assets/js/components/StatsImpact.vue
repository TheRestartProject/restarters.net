<template>
  <div>
    <h2 class="mt-2 mb-2">
      {{ translatedImpact }}
      <span v-b-popover.focus="translatedImpactCalculation">
        <b-img class="ml-2 icon-info clickable" src="/icons/info_ico_green.svg">
      </span>
    </h2>
    <div class="impact-container">
      <StatsValue :count="stats.ewaste + stats.unpowered_waste" icon="trash" size="md" title="partials.waste_prevented" unit="kg" class="impact-waste" />
      <div v-if="notincluded" class="d-flex justify-content-end">
        <div class="impact-notincluded">
          <div class="impact-notincluded-content p-1">
            {{ notincluded }}
          </div>
        </div>
      </div>
      <StatsValue :count="stats.co2" icon="cloud_empty" size="lg" title="partials.co2" subtitle="partials.powered_only" :description="equivalent_consumer(stats.co2)" unit="kg" class="impact-co2" />
    </div>
  </div>
</template>
<script>
import StatsValue from './StatsValue'
import co2equivalent from '../mixins/co2equivalent'

export default {
  components: {StatsValue},
  mixins: [ co2equivalent ],
  props: {
    stats: {
      required: true,
      type: Object
    },
    statsEntity: {
      required: true,
      type: String
    }
  },
  computed: {
    translatedImpact() {
      return this.$lang.get('events.environmental_impact')
    },
    translatedImpactCalculation() {
      return this.$lang.get('events.impact_calculation')
    },
    notincluded() {
      const langSource = this.statsEntity + 's'; // which lang file to look in, i.e. events or groups.
      let ret = []

      if (this.stats.dead_devices) {
        ret.push(this.$lang.choice(this.$lang.get('partials.to_be_recycled', {
          value: this.stats.dead_devices
        }), this.stats.dead_devices))
      }

      if (this.stats.repairable_devices) {
        ret.push(this.$lang.choice(this.$lang.get('partials.to_be_repaired', {
          value: this.stats.repairable_devices
        }), this.stats.repairable_devices))
      }

      if (this.stats.no_weight) {
        ret.push(this.$lang.choice(this.$lang.get('partials.no_weight', {
          value: this.stats.no_weight
        }), this.stats.no_weight))
      }

      if (!ret.length) {
        return null
      } else if (ret.length === 1) {
        const intro = this.$lang.choice(this.$lang.get(langSource + '.not_counting'), this.stats.no_weight)
        return intro + ' ' + ret[0] + '.'
      } else {
        const intro = this.$lang.choice(this.$lang.get(langSource + '.not_counting'), this.stats.no_weight)
        const first = ret.slice(0, -1)
        const last = ret[ret.length - 1]

        return intro + ' ' + first.join(', ') + ' ' + this.$lang.get('and') + ' ' + last + '.'
      }
    }
  }
}
</script>
<style scoped lang="scss">
@import 'resources/global/css/_variables';
@import '~bootstrap/scss/functions';
@import '~bootstrap/scss/variables';
@import '~bootstrap/scss/mixins/_breakpoints';

.impact-container {
  display: grid;
  grid-template-columns: 1fr;

  @include media-breakpoint-up(md) {
    grid-template-columns: 1fr 2fr;
  }
}

.impact-waste {
  grid-row-start: 1;
  grid-row-end: 2;
  grid-column-start: 1;
  grid-column-end: 2;
  margin-bottom: 20px;

  @include media-breakpoint-up(md) {
    margin-bottom: 0px;
  }
}

.impact-notincluded {
  display: grid;
  grid-row-start: 3;
  grid-row-end: 4;
  grid-column-start: 1;
  grid-column-end: 2;

  @include media-breakpoint-up(md) {
    grid-row-start: 2;
    grid-row-end: 2;
    align-content: end;
  }
}

.impact-co2 {
  grid-row-start: 2;
  grid-row-end: 3;
  grid-column-start: 1;
  grid-column-end: 2;
  margin-bottom: 20px;

  @include media-breakpoint-up(md) {
    grid-row-start: 1;
    grid-row-end: 3;
    grid-column-start: 2;
    grid-column-end: 3;
    margin-bottom: 0px;
    margin-left: 20px;
  }
}


.impact-notincluded-content {
  color: $brand-light;
  font-size: 11px;
  border: 1px solid $brand-light;
}

</style>
