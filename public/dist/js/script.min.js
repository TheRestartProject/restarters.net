$.fn.selectpicker.Constructor.DEFAULTS.iconBase="fa",$.fn.selectpicker.Constructor.DEFAULTS.tickIcon="fa-check",$(document).ready(function(){if($('[data-toggle="popover"]').popover(),$(".selectpicker, .category-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),$("button[type=reset]").click(function(a){$($(this).data("form")).find(".selectpicker").val("default").selectpicker("refresh")}),$(document).on("click","a.removebutton",function(){return $(this).closest("tr").remove(),!1}),$(document).on("click",".repairable",function(){var a=$(this).data("target-details");$(this).is(":checked")&&$(a).show()}),$(".repairable").each(function(a){if("2"==$(this).val()&&$(this).is(":checked")){var b=$(this).data("target-details");$(b).show()}}),$("#device-img-modal").on("show.bs.modal",function(a){var b=$(a.relatedTarget).clone();console.log(b),$(this).find(".modal-body").empty().append(b.find("img").removeClass("device-img"))}),$(".device-image-delete").click(function(a){if(a.preventDefault(),confirm("Are you sure? This cannot be undone.")){var b=$(this).parent(".device-img-wrap"),c=$(this).data("device-image"),d=$(this).next().children("img").attr("src"),e=d.split("/").pop();$.post("/ajax/delete_device_image",{id:c,file:e},function(a){1==a?b.remove():alert("Could not delete this file.")})}}),$("#add-device").click(function(a){a.preventDefault();var b=$("#device-table > tbody > tr").length,c=null,d=b+1;$.ajax({async:!1,url:"/ajax/category_list",data:{},dataType:"html",success:function(a){c=a}});var e='<tr class="newdevice"><td>'+d+'.</td><td><div class="form-group"><select id="device['+d+'][category]" name="device['+d+'][category]" class="category-select  form-control" data-live-search="true" tite="Choose category..." required="true"><option></option>'+c+'<option value="46">None of the above...</option></select></div><div class="form-group hide estimate-box"><small>Please input an estimate weight (in kg)</small><div class="input-group"><input type="number" step="00.01" min="0" max="99.99" name="device['+d+'][estimate]" id="device['+d+'][estimate]" class="form-control" placeholder="Estimate..."><span class="input-group-addon">kg</span></div></div></td><td><div class="form-group"><input type="text" name="device['+d+'][brand]" id="device['+d+'][brand]" class="form-control" placeholder="Brand - e.g. Apple, Dyson"></div><div class="form-group"><input type="text" name="device['+d+'][model]" id="device['+d+'][model]" class="form-control" placeholder="Model - e.g. iPhone 5s, DC50"></div><div class="form-group"><input type="'+f+'" name="device['+d+'][age]" id="device['+d+'][age]" class="form-control" placeholder="Age - e.g. 3 years"></div></td><td><textarea rows="6" class="form-control" placeholder="Information about the repair.  Where possible, try to provide: fault; cause of fault; and solution/advice given" id="device['+d+'][problem]" name="device['+d+'][problem]"></textarea></td>';if(!0===feature__device_photos){var f=feature__device_age?"text":"hidden";e+='<td><div class="form-group"><input type="file" class="form-control file" name="device['+d+'][image]" id="device['+d+']image" data-show-upload="false" data-show-caption="true"><small>upload a picture of the model/serial no. of the device</small></div></td>'}e+='<td><div class="form-group"><div class="radio"><label><input type="radio" name="device['+d+'][repair_status]" id="device['+d+'][repair_status_1]" value="1" checked> Fixed</label></div><div class="radio"><label><input type="radio" class="repairable" data-target-details="#repairable-details['+d+']" name="device['+d+'][repair_status]" id="device['+d+'][repair_status_2]" value="2"> Repairable</label></div><div id="repairable-details['+d+']" class="repairable-details"><div class="checkbox"><label><input type="checkbox" name="device['+d+'][more_time_needed]" id="device['+d+'][more_time_needed]" value="1"> More time needed</label></div><div class="checkbox"><label><input type="checkbox" name="device['+d+'][professional_help]" id="device['+d+'][professional_help]" value="1"> Professional help</label></div><div class="checkbox"><label><input type="checkbox" name="device['+d+'][do_it_yourself]" id="device['+d+'][do_it_yourself]" value="1"> Do it yourself</label></div></div><div class="radio"><label><input type="radio" name="device['+d+'][repair_status]" id="device['+d+'][repair_status_3]" value="3"> End of lifecycle</label></div></div></td><td><div class="form-group"><div class="checkbox"><label><input type="hidden" name="device['+d+'][spare_parts]" id="device['+d+'][spare_parts_2]" value="2"><input type="checkbox" name="device['+d+'][spare_parts]" id="device['+d+'][spare_parts_1]" value="1"> Yes</label></div></div></td><td><a class="removebutton btn delete-control"><i class="fa fa-trash"></i></a></td></tr>',$("#device-table tbody").append(e),$("tr.newdevice .category-select").selectpicker(),$("tr.newdevice .file").fileinput({browseIcon:'&nbsp;<span class="fa fa-upload"></span>&nbsp;',removeIcon:'<i class="fa fa-trash"></i> &nbsp;',previewFileIcon:'<i class="fa fa-file"></i> &nbsp;',icon:'<i class="fa fa-file"></i> &nbsp;'}),$("tr.newdevice .category-select").change(function(){var a=parseInt($(this).val());a>0&&null!=a&&(46===a?$(this).parent().parent().next(".estimate-box").removeClass("hide").addClass("show"):($(this).parent().parent().next(".estimate-box").removeClass("show").addClass("hide"),$(this).parent().parent().next(".estimate-box").children("input").val("")))}),$("tr.newdevice .repairable").click(function(){$(this).parent().parent().next(".repairable-details").addClass("show"),detailswrap.css({display:"block"})})}),$("#search-groups").change(function(){var a=$(this).find("option[value]:selected").map(function(){return this.text}).get();for($("#search-parties optgroup").addClass("hidden"),i=0;i<a.length;i++){var b=a[i];$('#search-parties optgroup[label="'+b+'"]').removeClass("hidden")}$("#search-parties").selectpicker("refresh")}),$("#search-groups option:selected").val()>0){var a=$("#search-groups").find("option[value]:selected").map(function(){return this.text}).get();for($("#search-parties optgroup").addClass("hidden"),i=0;i<a.length;i++){var b=a[i];$('#search-parties optgroup[label="'+b+'"]').removeClass("hidden")}$("#search-parties").selectpicker("refresh")}$(".category-select").change(function(){var a=parseInt($(this).val());a>0&&null!=a&&(46===a?$(this).parent().parent().next(".estimate-box").removeClass("hide").addClass("show"):$(this).parent().parent().next(".estimate-box").removeClass("show").addClass("hide"))}),$(".date, .date input").length>0&&($(".date, .date input").datetimepicker({icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-arrow-up",down:"fa fa-arrow-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-screenshot",clear:"fa fa-trash"},format:"DD/MM/YYYY",defaultDate:$(this).val()}),$(".time").datetimepicker({icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-arrow-up",down:"fa fa-arrow-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-screenshot",clear:"fa fa-trash"},format:"HH:mm",defaultDate:$(this).val()}),$(".from-date").datetimepicker({useCurrent:!1}),$(".to-date").datetimepicker({useCurrent:!1}),$(".from-date").on("dp.change",function(a){$(".to-date").data("DateTimePicker").minDate(a.date)}),$(".to-date").on("dp.change",function(a){$(".from-date").data("DateTimePicker").maxDate(a.date)})),$("#start-pc").on("dp.change",function(a){var b=$(this).val(),c=b.split(":");console.log(c[0]+" | "+c[1]),$("#end-pc").data("DateTimePicker").date(a.date.add(3,"h"))}),$(".rte").summernote({height:300,toolbar:[["cleaner",["cleaner"]],["style",["style","bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]],["insert",["link","hr"]],["misc",["codeview"]]],cleaner:{notTime:2400,action:"paste",newline:"<br />",notStyle:"position:absolute;top:0;left:0;right:0",icon:'<i class="note-icon"><span class="fa fa-paintbrush"></span></i>',keepHtml:!0,keepOnlyTags:["<p>","<br>","<ul>","<li>","<b>","<strong>","<i>","<a>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>"],keepClasses:!1,badTags:["style","script","applet","embed","noframes","noscript","html"],badAttributes:["style","start"]}}),$(".users_group").change(function(){var a=$(this).val();$.getJSON("/ajax/restarters_in_group",{group:a},function(a){var b="";a.forEach(function(a){b+='<div class="checkbox"><label for="users-'+a.id+'"><input type="checkbox" checked name="users[]" id="users-'+a.id+'" value="'+a.id+'"> '+a.name+" ("+a.role+")</label></div>"}),$(".users_group_list").html(b)})}),$('[name="repair_status"]').click(function(){$(this).is(":checked")&&"repair_status_2"==$(this).attr("id")?$("#repairable-details").slideDown("slow"):$("#repairable-details").hide("fast")}),$(".repairable").click(function(){var a=$(this).data("target-details");$(this).is(":checked")&&$(a).show()}),$(".delete-control").click(function(a){a.preventDefault();var b=$(this).attr("href"),c='<div class="ctrl-box-wrap"><div class="ctrl-box"><div class="ctrl-box-hdr"><h3>Are You Sure?<h3></div><div class="ctrl-box-body"><p>Please note that this operation is <strong>irreversible</strong>.</p></div><div class="ctrl-box-foot"><a href="'+b+'" class="btn btn-danger"><i class="fa fa-trash"></i> Delete</a> &nbsp;<a href="#" class="btn btn-default ctrl-box-close"><i class="fa fa-undo"></i> Cancel</a></div></div></div>';return $(".ctrl-box-wrap").length>0&&$(".ctrl-box-wrap").remove(),$("body").append(c),$(".ctrl-box-close").click(function(){$(".ctrl-box-wrap").remove()}),!1}),$(".remove-image").click(function(a){a.preventDefault();var b=$(this).parent(),c=$(this).data("remove-image"),d=$(this).data("image-path");return $.getJSON($(this).attr("href"),{id:c,path:d},function(){b.remove()}),!1}),$(".switch-view").click(function(a){a.preventDefault();var b=$(this).data("target"),c=$(this).data("family");$(".switch-view").removeClass("active"),$(this).addClass("active"),$(c).removeClass("show").addClass("hide"),$(b).addClass("show")}),$(".party-switch").click(function(a){a.preventDefault();var b=$(this).data("target");$(this).data("family");$(".party-switch").removeClass("active"),$(this).addClass("active"),"all"==b?$(".party").addClass("show").removeClass("hide"):($(".party").removeClass("show").addClass("hide"),$(b).addClass("show"))}),$("#device-table").length>0&&$("#device-table").floatThead(),$("#party-list").length>0&&$("#party-list").perfectScrollbar()});